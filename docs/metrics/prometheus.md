---
id: metrics_prometheus
title: "Prometheus Reporting"
---

## The ZMX Prometheus reporter 

```scala mdoc:invisible
import java.net.InetSocketAddress
import uzhttp.server.Server
import uzhttp._
import zio._
import zio.console._
import zio.zmx.metrics._
import zio.zmx.prometheus._
import zio.zmx.InstrumentedSample

```
In order to run the same example reporting to Prometheus, we need to plugin the Prometheus Reporter and provide a HTTP endpoint where the Prometheus agent can 
poll the collected metrics on a regular basis. 

```scala mdoc:silent
object PrometheusInstrumentedApp extends ZmxApp with InstrumentedSample {

  private val bindHost = "127.0.0.1"
  private val bindPort = 8080

  override def makeInstrumentation = PrometheusRegistry.make.map(r => new PrometheusInstrumentaion(r))

  override def run(args: List[String]): ZIO[ZEnv, Nothing, ExitCode] =
    (for {
      _ <- Server
             .builder(new InetSocketAddress(bindHost, bindPort))
             .handleSome {
               case req if req.uri.getPath() == "/"      =>
                 ZIO.succeed(Response.html("<html><title>Simple Server</title><a href=\"/metrics\">Metrics</a></html>"))
               case req if req.uri.getPath == "/metrics" =>
                 instrumentation.flatMap(i => i.report.map(r => Response.plain(r)))
             }
             .serve
             .use(s => s.awaitShutdown)
             .fork
      _ <- putStrLn("Press Any Key")
      _ <- program.fork
      f <- getStrLn.fork
      _ <- f.join.catchAll(_ => ZIO.none)
    } yield ExitCode.success)
}
```

Most of the code above is boilerplate code to provide a very simple HTTP server. The actual metrics document for Prometheus is generated by calling the `report` method on the instrumentation and map the outcome into a HTTP Response. 

For now we have made the decision not to bundle a specific HTTP implementation with ZMX, but just provide an example within the test code. So, users can use the example above to see how they can retrieve the metrics document and serve with the HTTP server of their choice. 

## Prometheus metric mappings 

### Counter 

### Gauge 

## Simple Prometheus setup 


